This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2024-10-06T06:57:10.713Z

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Info

For more information about Repopack, visit: https://github.com/yamadashy/repopack

# Repository Structure
```
.env.example
.gitignore
app/app.vue
app/pages/index.vue
eslint.config.mjs
nuxt.config.ts
package.json
README.md
server/api/generate.ts
server/routes/images/[...pathname].ts
server/tsconfig.json
tsconfig.json
```

# Repository Files

## File: .env.example
```
USERNAME="your-username"
PASSWORD="your-password"
```

## File: .gitignore
```
# Nuxt dev/build outputs
.output
.data
.nuxt
.nitro
.cache
.wrangler
dist

# Node dependencies
node_modules

# Logs
logs
*.log

# Misc
.DS_Store
.fleet
.idea

# Local env files
.env
.env.*
!.env.example
```

## File: app/app.vue
```vue
<script setup>
useSeoMeta({
  title: 'Flux-1 Schell Image Generator',
  description: 'Generate images with Flux-1 Schell and save them to your Cloudflare R2 bucket',
})
</script>

<template>
  <NuxtRouteAnnouncer />
  <NuxtLoadingIndicator />
  <NuxtPage />
</template>
```

## File: app/pages/index.vue
```vue
<script setup>
const prompt = ref('')
const steps = ref(4)
const src = ref('')
const loading = ref(false)
async function generateImage() {
  if (loading.value || !prompt.value) return
  loading.value = true
  const { pathname } = await $fetch('/api/generate', {
    method: 'POST',
    body: {
      prompt: prompt.value,
      steps: steps.value,
    },
  })
  src.value = `/images/${pathname}`
  loading.value = false
}
</script>

<template>
  <div class="flex flex-col items-center justify-center min-h-screen gap-4 text-center w-full max-w-[420px] mx-auto p-4 lg:p-0">
    <h1 class="text-3xl font-bold">
      Flux-1 Schell Image Generator
    </h1>
    <form class="w-full" @submit.prevent="generateImage()">
      <UTextarea
        v-model="prompt"
        placeholder="Enter a prompt"
        class="w-full mb-4"
        autoresize
      />
      <UFormGroup :label="`Number of steps (${steps})`" class="mb-4">
        <URange
          v-model="steps"
          :min="4"
          :max="8"
        />
      </UFormGroup>
      <UButton
        type="submit"
        color="black"
        block
        :loading="loading"
        :disabled="!prompt"
      >
        Generate
      </UButton>
    </form>
    <img v-if="src" :src="src" class="w-full max-w-[420px]">
  </div>
</template>
```

## File: eslint.config.mjs
```
// @ts-check
import withNuxt from './.nuxt/eslint.config.mjs'

export default withNuxt(
  // Your custom configs here
).overrideRules({
  'vue/max-attributes-per-line': ['warn', { singleline: 3 }],
})
```

## File: nuxt.config.ts
```typescript
// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  compatibilityDate: '2024-07-30',
  // https://nuxt.com/docs/getting-started/upgrade#testing-nuxt-4
  future: { compatibilityVersion: 4 },

  // https://nuxt.com/modules
  modules: [
    '@nuxthub/core',
    '@nuxt/eslint',
    '@nuxt/ui',
    '@kgierke/nuxt-basic-auth'
  ],

  // https://hub.nuxt.com/docs/getting-started/installation#options
  hub: {
    ai: true,
    blob: true,
  },

  basicAuth: {
    enabled: process.env.NODE_ENV === 'production',
    allowedRoutes: ['/api/_hub/'],
    users: [
      {
        username: process.env.USERNAME || 'admin',
        password: process.env.PASSWORD || 'admin'
      }
    ]
  },

  // https://eslint.nuxt.com
  eslint: {
    config: {
      stylistic: {
        quotes: 'single'
      }
    }
  },

  // https://devtools.nuxt.com
  devtools: { enabled: true }
})
```

## File: package.json
```json
{
  "name": "nuxt-app",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "nuxt build",
    "dev": "nuxt dev",
    "generate": "nuxt generate",
    "preview": "npx nuxthub preview",
    "deploy": "npx nuxthub deploy",
    "postinstall": "nuxt prepare",
    "lint": "eslint ."
  },
  "dependencies": {
    "@kgierke/nuxt-basic-auth": "^1.6.0",
    "@nuxt/eslint": "^0.5.7",
    "@nuxt/ui": "^2.18.6",
    "@nuxthub/core": "^0.7.24",
    "nuxt": "^3.13.2",
    "vue": "^3.5.11",
    "vue-router": "^4.4.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@nuxt/eslint-config": "^0.5.7",
    "eslint": "^9.12.0",
    "vue-tsc": "^2.1.6",
    "wrangler": "^3.80.0"
  },
  "packageManager": "pnpm@9.12.0"
}
```

## File: README.md
```markdown
# Generate images with AI using Flux-1 Schnell on Cloudflare

Deploy this application on your Cloudflare account and generate images with AI using Flux-1 Schell. Each image is generated with a prompt and number of steps and save in your Cloudflare R2 bucket.

https://github.com/user-attachments/assets/3d69ea0a-36e7-4698-a736-aa6bce551161

## Features

- Basic auth with username and password
- Generate images with Flux-1 Schell
- Save images to your Cloudflare R2 bucket
- AI Image gallery in development & production with [NuxtHub Blob](https://hub.nuxt.com/docs/features/blob)
- One click deploy on 275+ locations for free

[![Deploy to NuxtHub](https://hub.nuxt.com/button.svg)](https://hub.nuxt.com/new?template=flux-image-generator)

## Setup

Make sure to install the dependencies with [pnpm](https://pnpm.io/installation#using-corepack):

```bash
pnpm install
```

Link your project to [NuxtHub](https://hub.nuxt.com) after linking your Cloudflare account:

```bash
npx nuxthub link
```

## Development Server

Start the development server on `http://localhost:3000`:

```bash
pnpm dev
```

## Production

Build the application for production:

```bash
pnpm build
```

## Deploy


Deploy the application on the Edge with [NuxtHub](https://hub.nuxt.com) on your Cloudflare account:

```bash
npx nuxthub deploy
```

Then checkout your server logs, analaytics and more in the [NuxtHub Admin](https://admin.hub.nuxt.com).

You can also deploy using [Cloudflare Pages CI](https://hub.nuxt.com/docs/getting-started/deploy#cloudflare-pages-ci).
```

## File: server/api/generate.ts
```typescript
import { z } from 'zod'

export default eventHandler(async (event) => {

  const { prompt, steps } = await readValidatedBody(event, z.object({
    prompt: z.string(),
    steps: z.number().min(4).max(8).default(4)
  }).parse)

  const { image } = await hubAI().run('@cf/black-forest-labs/flux-1-schnell', {
    prompt,
    num_steps: steps
  })

  const blob = new Blob([Buffer.from(image, 'base64')], { type: 'image/png' })
  const pathname = `${Date.now()}.png`
  
  const blobObject = await hubBlob().put(pathname, blob, {
    customMetadata: {
      prompt,
      steps: String(steps)
    },
  })

  return blobObject
})
```

## File: server/routes/images/[...pathname].ts
```typescript
export default eventHandler(async (event) => {
  return hubBlob().serve(event, event.context.params!.pathname)
})
```

## File: server/tsconfig.json
```json
{
  "extends": "../.nuxt/tsconfig.server.json"
}
```

## File: tsconfig.json
```json
{
  // https://nuxt.com/docs/guide/concepts/typescript
  "extends": "./.nuxt/tsconfig.json"
}
```
