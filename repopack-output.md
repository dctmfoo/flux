This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2024-10-07T13:09:49.805Z

# File Summary

## Purpose
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Info

For more information about Repopack, visit: https://github.com/yamadashy/repopack

# Repository Structure
```
.cursorignore
.env.example
.gitignore
.npmrc
app/app.vue
app/pages/index.vue
auth.config.ts
eslint.config.mjs
nuxt.config.ts
package.json
README.md
server/api/auth/[...].ts
server/api/generate.ts
server/api/list-images.ts
server/routes/images/[...pathname].ts
server/tsconfig.json
tsconfig.json
```

# Repository Files

## File: .cursorignore
```
# Add directories or file patterns to ignore during indexing (e.g. foo/ or *.csv)
```

## File: .env.example
```
USERNAME="your-username"
PASSWORD="your-password"
AUTH_SECRET="your-auth-secret"
GITHUB_CLIENT_ID="your-github-client-id"
GITHUB_CLIENT_SECRET="your-github-client-secret"
ORIGIN="https://your-app.pages.dev"
```

## File: .gitignore
```
# Nuxt dev/build outputs
.output
.data
.nuxt
.nitro
.cache
.wrangler
dist


# Node dependencies
node_modules

# Logs
logs
*.log

# Misc
.DS_Store
.fleet
.idea

# Local env files
.env
.env.*
!.env.example

# Repopack output
@repopack-output.md
```

## File: .npmrc
```
auto-install-peers=true
strict-peer-dependencies=false
```

## File: app/app.vue
```vue
<script setup>
import { useAuth } from '#imports'

useSeoMeta({
  title: 'Flux-1 Schell Image Generator',
  description: 'Generate images with Flux-1 Schell and save them to your Cloudflare R2 bucket',
})

const { status, data: session, signIn, signOut } = useAuth()
</script>

<template>
  <div>
    <div class="auth-buttons">
      <template v-if="status === 'authenticated'">
        <p>Welcome, {{ session?.user?.name }}</p>
        <UButton @click="signOut({ callbackUrl: '/' })">Logout</UButton>
      </template>
      <UButton v-else @click="signIn('github')">Login with GitHub</UButton>
    </div>
    <NuxtPage />
  </div>
</template>

<style>
/* Remove any global styles that might interfere with our background image */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

.auth-buttons {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 1000;
}
</style>
```

## File: app/pages/index.vue
```vue
<script setup>
import { ref, onMounted, watch } from 'vue'

const prompt = ref('')
const steps = ref(4)
const src = ref('')
const gallery = ref([])
const loading = ref(false)
// Lightbox state
const isLightboxOpen = ref(false)
const currentLightboxIndex = ref(0)

async function fetchGallery() {
  try {
    gallery.value = await $fetch('/api/list-images')
  } catch (error) {
    console.error('Error fetching gallery:', error)
  }
}

async function generateImage() {
  if (loading.value || !prompt.value) return
  loading.value = true
  try {
    const { pathname } = await $fetch('/api/generate', {
      method: 'POST',
      body: {
        prompt: prompt.value,
        steps: steps.value,
      },
    })
    src.value = `/images/${pathname}`
    gallery.value.unshift(pathname)
  } catch (error) {
    console.error('Error generating image:', error)
  } finally {
    loading.value = false
  }
}

function openLightbox(index) {
  currentLightboxIndex.value = index
  isLightboxOpen.value = true
}

function nextImage() {
  currentLightboxIndex.value = (currentLightboxIndex.value + 1) % gallery.value.length
}

function prevImage() {
  currentLightboxIndex.value = (currentLightboxIndex.value - 1 + gallery.value.length) % gallery.value.length
}

function handleKeydown(event) {
  if (!isLightboxOpen.value) return
  if (event.key === 'ArrowRight') nextImage()
  if (event.key === 'ArrowLeft') prevImage()
  if (event.key === 'Escape') isLightboxOpen.value = false
}

onMounted(() => {
  fetchGallery()
  window.addEventListener('keydown', handleKeydown)
})

watch(isLightboxOpen, (newValue) => {
  if (newValue) {
    document.body.style.overflow = 'hidden'
  } else {
    document.body.style.overflow = ''
  }
})
</script>

<template>
  <div class="home-container">
    <div class="flex flex-col items-center justify-center min-h-screen gap-4 text-center w-full max-w-[420px] mx-auto p-4 lg:p-0">
      <h1 class="text-3xl font-bold">
        Flux-1 Schell Image Generator
      </h1>
      <form class="w-full" @submit.prevent="generateImage">
        <UTextarea
          v-model="prompt"
          placeholder="Enter a detailed prompt"
          class="w-full mb-4"
          autoresize
        />
        <UFormGroup :label="`Number of steps (${steps})`" class="mb-4">
          <URange
            v-model="steps"
            :min="4"
            :max="8"
          />
        </UFormGroup>
        <UButton
          type="submit"
          color="black"
          block
          :loading="loading"
          :disabled="!prompt"
        >
          Generate
        </UButton>
      </form>

      <img v-if="src" :src="src" class="w-full max-w-[420px] my-4">

      <!-- Gallery Section -->
      <div v-if="gallery.length > 0" class="gallery grid grid-cols-3 gap-4 w-full mt-6">
        <div
          v-for="(image, index) in gallery"
          :key="index"
          class="border border-gray-200 rounded-lg overflow-hidden cursor-pointer"
          @click="openLightbox(index)"
        >
          <img :src="`/images/${image}`" alt="Generated image" class="w-full h-full object-cover">
        </div>
      </div>

      <!-- Lightbox Modal -->
      <UModal v-model="isLightboxOpen" :ui="{ width: 'max-w-3xl' }">
        <UCard class="relative">
          <img 
            :src="`/images/${gallery[currentLightboxIndex]}`" 
            alt="Lightbox image" 
            class="max-w-full max-h-[80vh] object-contain"
          >
          <div class="absolute top-1/2 left-4 transform -translate-y-1/2">
            <UButton icon="i-heroicons-chevron-left-20-solid" color="white" variant="ghost" @click="prevImage" />
          </div>
          <div class="absolute top-1/2 right-4 transform -translate-y-1/2">
            <UButton icon="i-heroicons-chevron-right-20-solid" color="white" variant="ghost" @click="nextImage" />
          </div>
        </UCard>
      </UModal>
    </div>

  </div>
</template>

<style scoped>
.home-container {
  min-height: 100vh;
  background-image: url('/images/teal.png'); /* Remove 'public' from the path */
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  color: white; /* Add this to ensure text is visible */
}

/* Existing styles */
</style>
```

## File: auth.config.ts
```typescript
import GithubProvider from 'next-auth/providers/github'
import type { AuthOptions } from '@auth/core'

export const authOptions: AuthOptions = {
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_CLIENT_ID as string,
      clientSecret: process.env.GITHUB_CLIENT_SECRET as string
    })
  ],
  secret: process.env.AUTH_SECRET
}
```

## File: eslint.config.mjs
```
// @ts-check
import withNuxt from './.nuxt/eslint.config.mjs'

export default withNuxt(
  // Your custom configs here
).overrideRules({
  'vue/max-attributes-per-line': ['warn', { singleline: 3 }],
})
```

## File: nuxt.config.ts
```typescript
import { defineNuxtConfig } from 'nuxt/config'

export default defineNuxtConfig({
  compatibilityDate: '2024-07-30',
  // https://nuxt.com/docs/getting-started/upgrade#testing-nuxt-4
  future: { compatibilityVersion: 4 },

  // https://nuxt.com/modules
  modules: [
    '@nuxthub/core',
    '@nuxt/eslint',
    '@nuxt/ui',
    '@kgierke/nuxt-basic-auth',
    '@sidebase/nuxt-auth'
  ],

  // https://hub.nuxt.com/docs/getting-started/installation#options
  hub: {
    ai: true,
    blob: true
  },

  basicAuth: {
    enabled: process.env.NODE_ENV === 'production',
    allowedRoutes: ['/api/_hub/'],
    users: [
      {
        username: process.env.USERNAME || 'admin',
        password: process.env.PASSWORD || 'admin'
      }
    ]
  },

  // https://eslint.nuxt.com
  eslint: {
    config: {
      stylistic: {
        quotes: 'single'
      }
    }
  },

  // https://devtools.nuxt.com
  devtools: { enabled: true },

  vite: {
    assetsInclude: ['**/*.jpg', '**/*.png', '**/*.gif'],
  },

  auth: {
    origin: process.env.ORIGIN,
    enableGlobalAppMiddleware: true,
    globalMiddlewareOptions: {
      allow: ['/', '/api/auth/**']
    }
  },

  runtimeConfig: {
    auth: {
      githubClientId: process.env.GITHUB_CLIENT_ID,
      githubClientSecret: process.env.GITHUB_CLIENT_SECRET
    }
  }
})
```

## File: package.json
```json
{
  "name": "nuxt-app",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "nuxt build",
    "dev": "nuxt dev",
    "generate": "nuxt generate",
    "preview": "npx nuxthub preview",
    "deploy": "npx nuxthub deploy",
    "postinstall": "nuxt prepare",
    "lint": "eslint .",
    "prepare": "pnpm install --no-frozen-lockfile"
  },
  "dependencies": {
    "@kgierke/nuxt-basic-auth": "^1.6.0",
    "@nuxt/eslint": "^0.5.7",
    "@nuxt/ui": "^2.18.6",
    "@nuxthub/core": "^0.7.24",
    "nuxt": "^3.13.2",
    "vue": "^3.5.11",
    "vue-router": "^4.4.5",
    "zod": "^3.23.8",
    "@sidebase/nuxt-auth": "^0.6.0-beta.3"
  },
  "devDependencies": {
    "@nuxt/eslint-config": "^0.5.7",
    "eslint": "^9.12.0",
    "vue-tsc": "^2.1.6",
    "wrangler": "^3.80.0",
    "@auth/core": "^0.5.1",
    "@types/node": "^18.0.0"
  },
  "packageManager": "pnpm@9.12.0"
}
```

## File: README.md
```markdown
# Generate images with AI using Flux-1 Schnell on Cloudflare

Deploy this application on your Cloudflare account and generate images with AI using Flux-1 Schell. Each image is generated with a prompt and number of steps and save in your Cloudflare R2 bucket.

https://github.com/user-attachments/assets/3d69ea0a-36e7-4698-a736-aa6bce551161

## Features

- Basic auth with username and password
- Generate images with Flux-1 Schell
- Save images to your Cloudflare R2 bucket
- AI Image gallery in development & production with [NuxtHub Blob](https://hub.nuxt.com/docs/features/blob)
- One click deploy on 275+ locations for free

[![Deploy to NuxtHub](https://hub.nuxt.com/button.svg)](https://hub.nuxt.com/new?template=flux-image-generator)

## Setup

Make sure to install the dependencies with [pnpm](https://pnpm.io/installation#using-corepack):

```bash
pnpm install
```

Link your project to [NuxtHub](https://hub.nuxt.com) after linking your Cloudflare account:

```bash
npx nuxthub link
```

## Development Server

Start the development server on `http://localhost:3000`:

```bash
pnpm dev
```

## Production

Build the application for production:

```bash
pnpm build
```

## Deploy


Deploy the application on the Edge with [NuxtHub](https://hub.nuxt.com) on your Cloudflare account:

```bash
npx nuxthub deploy
```

Then checkout your server logs, analaytics and more in the [NuxtHub Admin](https://admin.hub.nuxt.com).

You can also deploy using [Cloudflare Pages CI](https://hub.nuxt.com/docs/getting-started/deploy#cloudflare-pages-ci).


## GitHub Login Setup

1. Go to GitHub Developer Settings: https://github.com/settings/developers
2. Create a new OAuth App
3. Set the Authorization callback URL to `https://your-app.pages.dev/api/auth/callback/github`
4. Note down the Client ID and Client Secret
5. Set the following environment variables in your NuxtHub dashboard:
   - `AUTH_SECRET`: A random string used to encrypt cookies and tokens
   - `GITHUB_CLIENT_ID`: Your GitHub OAuth App client ID
   - `GITHUB_CLIENT_SECRET`: Your GitHub OAuth App client secret
   - `ORIGIN`: The URL of your deployed app (e.g., https://your-app.pages.dev)

## Deployment

Before deploying, make sure to update the build command in your NuxtHub dashboard:

1. Go to your project settings in the NuxtHub dashboard.
2. Find the "Build Command" setting.
3. Change it to: `pnpm run update-lockfile && pnpm run build`

This will ensure that the lock file is updated and dependencies are correctly installed during the build process.

Then, deploy the application on the Edge with [NuxtHub](https://hub.nuxt.com) on your Cloudflare account:

```bash
npx nuxthub deploy
```

Then checkout your server logs, analaytics and more in the [NuxtHub Admin](https://admin.hub.nuxt.com).

You can also deploy using [Cloudflare Pages CI](https://hub.nuxt.com/docs/getting-started/deploy#cloudflare-pages-ci).


## GitHub Login Setup

1. Go to GitHub Developer Settings: https://github.com/settings/developers
2. Create a new OAuth App
3. Set the Authorization callback URL to `https://your-app.pages.dev/api/auth/callback/github`
4. Note down the Client ID and Client Secret
5. Set the following environment variables in your NuxtHub dashboard:
   - `AUTH_SECRET`: A random string used to encrypt cookies and tokens
   - `GITHUB_CLIENT_ID`: Your GitHub OAuth App client ID
   - `GITHUB_CLIENT_SECRET`: Your GitHub OAuth App client secret
   - `ORIGIN`: The URL of your deployed app (e.g., https://your-app.pages.dev)
```

## File: server/api/auth/[...].ts
```typescript
import { NuxtAuthHandler } from '#auth'
import { authOptions } from '~/auth.config'

export default NuxtAuthHandler(authOptions)
```

## File: server/api/generate.ts
```typescript
import { z } from 'zod'

export default eventHandler(async (event) => {

  const { prompt, steps } = await readValidatedBody(event, z.object({
    prompt: z.string(),
    steps: z.number().min(4).max(8).default(4)
  }).parse)

  const { image } = await hubAI().run('@cf/black-forest-labs/flux-1-schnell', {
    prompt,
    num_steps: steps
  })

  const blob = new Blob([Buffer.from(image, 'base64')], { type: 'image/png' })
  const pathname = `${Date.now()}.png`
  
  const blobObject = await hubBlob().put(pathname, blob, {
    customMetadata: {
      prompt,
      steps: String(steps)
    },
  })

  return blobObject
})
```

## File: server/api/list-images.ts
```typescript
export default defineEventHandler(async (event) => {
  const { blobs } = await hubBlob().list({
    limit: 100 // Adjust this number as needed
  });
  
  return blobs
    .filter(blob => blob.contentType.startsWith('image/'))
    .map(blob => blob.pathname);
});
```

## File: server/routes/images/[...pathname].ts
```typescript
export default eventHandler(async (event) => {
  return hubBlob().serve(event, event.context.params!.pathname)
})
```

## File: server/tsconfig.json
```json
{
  "extends": "../.nuxt/tsconfig.server.json"
}
```

## File: tsconfig.json
```json
{
  // https://nuxt.com/docs/guide/concepts/typescript
  "extends": "./.nuxt/tsconfig.json"
}
```
